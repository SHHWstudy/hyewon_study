# 🥕아키텍처 설계 메모장🥕

## 📌 아키텍처 설계 전
### ✔ 요청사항
 1. 성능테스트 및 목표 객관화를 위한 ``AS-IS, TO-BE 명세화``가 필요함.
 2. ``기존 데이터에 대한 정의``가 필요함.
    - 실시간으로 변하지 않고 변화의 속도가 굉장히 느린 데이터가 뭔지에 대해 조사하며, 큰 데이터가 무엇인지 분리가 필요함. 
    - 변화가 느린 데이터라면 S3 같은 곳에 HTML 문서로 올려놓는 방법도 검토 필요.
 3. 각 서비스 영역에 대한 ``통계 데이터``가 필요함. >> 대략 잡아서 작업하기 ..
    - 평균 트래픽 수
    - 최대 트래픽 수
    - 총 회원 수
    - 시간별 각 서비스에 대한 사용량 변화 (호출(사용) 건 수)

### ✔ 계획세우기
 1. ``목표 TPS 정의하기``
    - 서비스 하는 사업의 DAU/MAU 요청, 어렵다면 비슷한 서비스와 비교하기 
 2. ``병목구간 모니터링``
    - 슬루스(Sleuth), 키바나(Kibana) 등 사용하기
    - SpringBoot + Opentracing
 3. ``성능테스트``
    - 기술 문제인지 성능 문제인지 검토 필요
    - 문제상황 해결 후 입증하기 위해서는 성능테스트가 필수
    - 엔그라인더(nGrinder) 사용해보기.
    
### ✔ 고려사항
 -	서비스가 많아짐에 따라 API와 DB가 점점 커지게되며, 계속 변화가 생기게 됨. 이 부분을 고려하여 설계해야 레거시 데이터를 줄일 수 있음.
 - 서버리스를 도입한다 했을 때, TPS를 요구하기 위해 증명하는 과정이 필요하며, 계정의 리소스 및 커뮤니케이션 비용 발생도 고려해야함.
 -	빠른 구현을 위해 서버리스로 우선 구현 후 이후 생기는 문제들에 대해 고민하는 방식 고려
 
### ✔ 클라우드 네이티브 자바 읽어보기
 
 <br />
   

## 📌 ``DynamoDB`` vs ElastiCache
> 일정상의 문제(러닝커브) 등으로 ``ElastiCache`` 채택 >> 현재 서비스에서 러닝커브가 크지 않을 것으로 예상 ``DynamoDB`` 채택
 - ElastiCache의 경우 VPC 영역에서 사용함. (DynamoDB, Lambda는 Amazon 영역에서 사용함)
 - ElastiCache를 사용하기 위해서는 VPC 영역을 통과해야 함. 굳이 VPC를 사용해서 리소스를 늘릴 필요가 없다고 판단함.
 - _현재 서비스에서 dynamoDB로의 러닝커브가 크지 않을 것으로 예상되어짐._
    -	백앤드와 REST API에 대한 이해도가 높다면 2~3주 기간만 지나면 쉽게 개발 가능 예상함. 
    
<br />

## 📌 ``DynamoDB`` vs MongoDB 
> ``DynamoDB`` 채택
 - 높은 트래픽을 지속적으로 받고 있다면 on-premise가 적합하지만, 트래픽 수 변화가 잦다면 비용 측면에서 적합하지 않음.
 - MongoDB를 사용하기 위해서는 운영을 위한 전문가가 필요함. 경험이 없는 인원이 전담했을 시 ``장애 예측이 어려움``. (숙련된 개발자들도 어려움!)
 - 안정적인 성능을 내기위해 파티셔닝 작업이 필요함. 이 작업을 거치면 write시 부하를 줄일 수 있음. dynamoDB의 경우 ``스케일 업과 파티셔닝``이 자동으로 작업됨.
 - 특정 클라우드로의 종속성 문제의 경우 다른 클라우드로의 변환도 어렵지 않을 것으로 예상함.
 - 타 퍼블릭 클라우드(예: 네이버 클라우드, GCP…) 또한 AWS와 동일한 기능을 제공해주며 사용법도 거의 동일함. 그 중 AWS의 경우 클라우드 네이티브 생태계를 가장 많이 구현해 놓음.

<br />


## 📌 ``Redis`` 도입 검토
> 굳이 ..
 - 사내에서 서버를 구축해서 쓰거나 Docker를 사용하는 경우 Redis는 인메모리 DB처럼 빠르게 동작함. 하지만 EC2 등 서버에 연결하여 쓰기와 읽기를 사용할 시 예상했던 속도보다 느리며, 초 단위의 지연이 발생함
 - Redis를 사용한다면, Redis-Cluster 사용 검토. 만약 클러스터 모드로 사용한다면 부하를 미리 추정하여 용량에 맞게 클러스터 규모를 잡아주는 것이 중요함.

<br />

## 📌 ``DynamoDB``
 - 스키마가 따로 정해져 있지 않음
 - JSON 형태로 데이터 저장
 - 수평확장(scale-out)이 쉽고 유연 ``(Auto-Scaling)``
 - Primary Key로 ``Partition Key``를 가지고 있음.
    - Partition Key 때문에 응답시간이 일관됨.
 - NoSQL 엔지니어가 없어도 대용량 트래픽 처리 가능한 어플리케이션을 개발 가능
 - 데이터 자동 복제
    - 기본적으로 1개의 Region에 3개의 복제본을 만들어 놓기 때문에 한 곳에서 장애가 나더라도 가용성을 유지 가능함.
 
 
 ### ➕ ``DynamoDB Accelerator(DAX)``
 ```
   Q.	DynamoDB와 DAX를 결합하여 DynamoDB + ElastiCache와 같은 성능을 낼 수 있는가?    
   A.	기대하는 효과는 똑같이 나올 것으로 예상함. DynamoDB를 극대화된 성능으로 사용하는 형상임.
```
- DynamoDB 비용을 절감하고 어플리케이션 처리하는 캐싱로직을 제거함으로써 데이터 일치와 복잡도 감소 가능.
